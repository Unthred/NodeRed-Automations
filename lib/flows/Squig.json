[{"id":"6efb7764.b7ff28","type":"function","z":"d71c67f7.8fae88","name":"Heating Controller!","func":"function createNewMessage(temp, operation, room) {\n    var result = {\n        msg : {\n            payload : {\n                domain : \"climate\",\n                service : \"set_temperature\",\n                data : {\n                    entity_id : \"climate.\" + room,\n                    temperature : temp,\n                    operation_mode : operation\n                }\n            } \n        }\n    };\n    \n    return result;\n}\nvar now = new Date();\n\n// What rooms get turned on what days\nvar rooms = [\n    {name : \"bedroom\",   target : \"19\", days : [\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\", \"Sunday\"]},\n    {name : \"katrin\",    target : \"21\", days : []},\n    {name : \"kitchen\",   target : \"19\", days : [\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\", \"Sunday\"]},\n    {name : \"livingroom\",target : \"19\", days : [\"Saturday\", \"Sunday\"]},\n    {name : \"Office\",    target : \"19\", days : []},\n    {name : \"Vestibule\", target : \"18\", days : [\"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\", \"Sunday\"]},\n    ];\nvar heatingStatusMsg = \"Setting \";\n\nfor (var index in rooms) {\n    // Are we turning heating on today in this room?\n    var day = rooms[index].days[ now.getDay() ];\n    var switchHeatingOn = msg.payload === \"on\" && day !== undefined;\n    // What temperature and mode should it be \n    var temp = switchHeatingOn ? rooms[index].target : \"8\";\n    var operation = switchHeatingOn ? \"Heat\" : \"Idle\";\n    \n    heatingStatusMsg += rooms[index].name + \" to \" + (switchHeatingOn ? temp + \" degrees\" : \"idle\");\n    if (index < rooms.length) {\n        heatingStatusMsg += \", \";\n    }\n\n    var result = createNewMessage(temp, operation, rooms[index].name);\n    \n    node.send(result.msg, null);\n}\nvar updateMsg = {\n    payload : {\n        data : {\n            message : heatingStatusMsg\n        }\n    }\n}\n\nnode.send([[null], [updateMsg]]);\nnode.on(\"close\", function() {\n    \n});\n\nreturn;","outputs":"2","noerr":0,"x":490,"y":180,"wires":[["fffd23a6.8f254","d158d189.89189"],["99d85b6a.48b568","b6ff3334.08b42"]]}]